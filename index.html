<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spin the Wheel - Loyalty Points</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    h1 { color: #4CAF50; }
    .input-container { display: flex; justify-content: center; align-items: center; margin: 10px; height: 60px; }
    input, button { padding: 10px; font-size: 16px; margin: 10px; }
    #wheelResult { font-weight: bold; font-size: 24px; margin-top: 20px; }
    table { margin: 20px auto; border-collapse: collapse; width: 100%; max-width: 500px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #f2f2f2; }
    #closeSession { background-color: #2196F3; color: white; }
    #resetList { background-color: #9E9E9E; color: white; }
    .wheel-container { margin: 20px auto; max-width: 300px; }
    .wheel-container img { width: 100%; border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
  </style>
</head>
<body>
  <h1>üéØ Spin the Wheel - Loyalty Points</h1>
  <div class="input-container">
    <input type="text" id="affiliateId" placeholder="Enter Affiliate ID" style="text-align: center; width: 250px;" />
  </div>
  <button onclick="spinWheel()">Spin the Wheel</button>

  <div class="wheel-container">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Wheel_of_Fortune_game_show_wheel.svg/800px-Wheel_of_Fortune_game_show_wheel.svg.png" alt="Wheel of Fortune Illustration">
  </div>

  <p id="wheelResult"></p>
  <h2>üèÜ Current Spin</h2>
  <table id="winnerTable">
    <thead>
      <tr><th>Affiliate ID</th><th>Prize</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="resetList" onclick="resetDisplay()">üßπ Reset Display</button>
  <button id="closeSession" onclick="closeSession()">‚ùå Close Session & Download CSV</button>

  <script>
    const weightedPrizes = [
      ...Array(75).fill("5 Loyalty Points"),
      ...Array(10).fill("10 Loyalty Points"),
      ...Array(10).fill("20 Loyalty Points"),
      ...Array(5).fill("100 Loyalty Points")
    ];

    const winnerTableBody = document.querySelector("#winnerTable tbody");
    const sessionWinners = [];

    function spinWheel() {
      const affiliateId = document.getElementById("affiliateId").value.trim();
      if (!affiliateId) {
        alert("Please enter an Affiliate ID.");
        return;
      }
      const prize = weightedPrizes[Math.floor(Math.random() * 100)];
      document.getElementById("wheelResult").innerText = `üéâ ${affiliateId} won ${prize}!`;

      // Clear previous row from table
      winnerTableBody.innerHTML = "";

      const row = winnerTableBody.insertRow();
      row.insertCell(0).innerText = affiliateId;
      row.insertCell(1).innerText = prize;

      sessionWinners.push({ id: affiliateId, prize });
    }

    function resetDisplay() {
      document.getElementById("wheelResult").innerText = "";
      winnerTableBody.innerHTML = "";
    }

    function closeSession() {
      if (sessionWinners.length === 0) {
        alert("No spins have occurred yet.");
        return;
      }
      let csvContent = "Affiliate ID,Prize\n";
      for (let entry of sessionWinners) {
        csvContent += `${entry.id},${entry.prize}\n`;
      }
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'winning_list.csv';
      a.click();

      // Reset session data and UI
      sessionWinners.length = 0;
      document.getElementById("affiliateId").value = "";
      document.getElementById("wheelResult").innerText = "";
      winnerTableBody.innerHTML = "";
    }
  </script>
</body>
</html>
